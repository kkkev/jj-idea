<idea-plugin>
    <id>in.kkkev.jj-idea</id>
    <name>Jujutsu VCS Integration</name>
    <vendor email="jj-idea@kkkev.in" url="https://github.com/kkkev/jj-idea">Kevin Thomas</vendor>

    <resource-bundle>messages.JujutsuBundle</resource-bundle>

    <description><![CDATA[
    Native integration with Jujutsu (jj) version control system.

    Features:
    - JJ-native workflow tool window (left side)
    - Describe-first workflow support
    - Continuous commit workflow
    - Working copy status and diffs
    - Commands: jj describe, jj new

    Jujutsu is a Git-compatible VCS that treats the working copy as a commit,
    enabling a more natural workflow with continuous commits and no staging area.
    ]]></description>

    <depends>com.intellij.modules.platform</depends>
    <depends>com.intellij.modules.vcs</depends>

    <extensions defaultExtensionNs="com.intellij">
        <vcs name="Jujutsu" vcsClass="in.kkkev.jjidea.vcs.JujutsuVcs" />
        <vcsRootChecker implementation="in.kkkev.jjidea.vcs.JujutsuRootChecker" order="first"/>
        <logProvider implementation="in.kkkev.jjidea.vcs.JujutsuLogProvider" />


        <!-- Modern file history handler (toolbar at top, details on right) -->
        <vcsLogFileHistoryHandler implementation="in.kkkev.jjidea.vcs.history.JujutsuLogFileHistoryHandler" order="first" />

        <!-- Custom VCS Log columns (order affects default layout) -->
        <vcsLogCustomColumn implementation="in.kkkev.jjidea.vcs.log.JujutsuStatusColumn" />
        <vcsLogCustomColumn implementation="in.kkkev.jjidea.vcs.log.JujutsuChangeIdColumn" />
        <vcsLogCustomColumn implementation="in.kkkev.jjidea.vcs.log.JujutsuDescriptionColumn" />
        <vcsLogCustomColumn implementation="in.kkkev.jjidea.vcs.log.JujutsuCommitterColumn" />

        <!-- Services -->
        <projectService serviceImplementation="in.kkkev.jjidea.jj.LogCache" />
        <projectService serviceImplementation="in.kkkev.jjidea.jj.JujutsuStateModel" />
        <projectService serviceImplementation="in.kkkev.jjidea.ui.log.JujutsuCustomLogTabManager" />
        <projectService serviceImplementation="in.kkkev.jjidea.settings.JujutsuSettings" />

        <!-- Settings -->
        <projectConfigurable
            id="vcs.Jujutsu"
            displayName="Jujutsu"
            instance="in.kkkev.jjidea.settings.JujutsuConfigurable"
            parentId="project.propVCSSupport.Mappings" />

        <!-- Jujutsu working copy tool window on the left side -->
        <toolWindow
            id="Working copy"
            anchor="left"
            icon="AllIcons.Vcs.Branch"
            factoryClass="in.kkkev.jjidea.ui.workingcopy.WorkingCopyToolWindowFactory"
        />
    </extensions>

    <actions>
        <action id="Jujutsu.Init" class="in.kkkev.jjidea.vcs.actions.InitAction">
            <add-to-group group-id="Vcs.Import"/>
            <add-to-group group-id="Vcs.Operations.Popup.NonVcsAware" relative-to-action="Start.Use.Vcs" anchor="before"/>
            <add-to-group group-id="Vcs.ToolWindow.CreateRepository"/>
            <override-text place="Vcs.Toolbar.Widget"/>
        </action>

        <!-- Open custom Jujutsu log tab -->
        <action id="Jujutsu.OpenLogTab"
                class="in.kkkev.jjidea.vcs.actions.OpenJujutsuLogTabAction">
            <!-- Text and description are set in the action class constructor -->
            <!-- Not added to VcsGroup to avoid StandardVcsGroup requirement -->
        </action>

        <!-- Jujutsu action group in editor context menu -->
        <group id="Jujutsu.EditorGroup" text="Jujutsu" class="in.kkkev.jjidea.vcs.actions.JujutsuEditorActionGroup" popup="true">
            <action id="Jujutsu.EditorAnnotate" class="in.kkkev.jjidea.vcs.actions.JujutsuAnnotateAction"/>
            <action id="Jujutsu.CompareWithBranch" class="in.kkkev.jjidea.vcs.actions.JujutsuCompareWithBranchAction"/>
            <reference ref="Vcs.ShowTabbedFileHistory"/>
            <action id="Jujutsu.ShowHistoryForSelection" class="in.kkkev.jjidea.vcs.actions.JujutsuShowHistoryForSelectionAction"/>
            <!--<add-to-group group-id="EditorPopupMenu" anchor="after" relative-to-action="EditorPopupMenu.GoToMenu"/>-->
            <add-to-group group-id="VcsGroup" anchor="last"/>
        </group>
    </actions>

    <projectListeners>
        <listener class="in.kkkev.jjidea.ui.ToolWindowEnabler"
                  topic="com.intellij.dvcs.repo.VcsRepositoryMappingListener"
                  activeInHeadlessMode="false" activeInTestMode="false"/>

    </projectListeners>
</idea-plugin>

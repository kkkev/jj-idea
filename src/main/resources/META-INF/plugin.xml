<idea-plugin>
    <id>in.kkkev.jj-idea</id>
    <name>Jujutsu VCS Integration</name>
    <vendor email="jj-idea@kkkev.in" url="https://github.com/kkkev/jj-idea">Kevin Thomas</vendor>

    <resource-bundle>messages.JujutsuBundle</resource-bundle>

    <description><![CDATA[
    <p>Native IntelliJ integration for <a href="https://jj-vcs.github.io/jj/">Jujutsu (jj)</a>, a Git-compatible version control system with a fundamentally different approach to working with code.</p>

    <h3>Why Jujutsu?</h3>
    <p>Jujutsu treats your working copy as a commit—always. No staging area, no "dirty" state. Just describe what you're working on and keep coding. When you're ready to start something new, create a new change. It's version control that works the way you think.</p>

    <h3>Key Features</h3>
    <ul>
        <li><b>Describe-First Workflow</b> — The Working Copy tool window (left side) lets you describe your current work and create new changes with one click. No more "WIP" commits.</li>
        <li><b>Custom Log View</b> — Visual commit graph with inline change IDs, descriptions, bookmarks, and author info. Filter by text, branch, author, or date range.</li>
        <li><b>Change Operations</b> — Edit, abandon, describe, and rebase changes directly from the log. Right-click context menus for common operations.</li>
        <li><b>Rebase</b> — Full rebase dialog with source mode selection (-r/-s/-b), visual destination picker with commit graph, and live preview of the post-rebase state.</li>
        <li><b>Git Remotes</b> — Fetch and push to Git remotes without leaving the IDE. Push dialog with remote selector and bookmark scope options.</li>
        <li><b>File History &amp; Annotations</b> — Full file history with diff viewer. Line-by-line blame annotations showing who changed what and when.</li>
        <li><b>Multi-Repository Support</b> — Work with multiple JJ repositories in a single project. Unified log view with per-repo filtering.</li>
        <li><b>Real-Time Status</b> — Auto-refresh keeps the UI in sync as you edit files. See modified, added, and deleted files instantly.</li>
    </ul>

    <h3>For JJ Users</h3>
    <p>If you're already using JJ from the command line, this plugin brings that workflow into your IDE. All the power of <code>jj describe</code>, <code>jj new</code>, <code>jj edit</code>, <code>jj abandon</code>, and <code>jj rebase</code>—with visual feedback and keyboard shortcuts.</p>

    <h3>Getting Started</h3>
    <ol>
        <li>Install <a href="https://jj-vcs.github.io/jj/latest/install/">Jujutsu</a> if you haven't already</li>
        <li>Open a project with a <code>.jj</code> directory (or initialize one with <b>VCS → Create JJ Repository</b>)</li>
        <li>The Working Copy panel appears on the left; the Jujutsu log appears in the Version Control tool window</li>
    </ol>

    <p><a href="https://github.com/kkkev/jj-idea">GitHub</a> · <a href="https://github.com/kkkev/jj-idea/issues">Issues</a></p>
    ]]></description>

    <depends>com.intellij.modules.platform</depends>
    <depends>com.intellij.modules.vcs</depends>

    <extensions defaultExtensionNs="com.intellij">
        <vcs name="Jujutsu" vcsClass="in.kkkev.jjidea.vcs.JujutsuVcs" administrativeAreaName=".jj" />
        <vcsRootChecker implementation="in.kkkev.jjidea.vcs.JujutsuRootChecker" order="first"/>
        <logProvider implementation="in.kkkev.jjidea.vcs.JujutsuLogProvider" />

        <!-- Services -->
        <projectService serviceImplementation="in.kkkev.jjidea.jj.LogCache" />
        <projectService serviceImplementation="in.kkkev.jjidea.jj.JujutsuStateModel" />
        <projectService serviceImplementation="in.kkkev.jjidea.ui.log.JujutsuCustomLogTabManager" />
        <projectService serviceImplementation="in.kkkev.jjidea.ui.history.JujutsuFileHistoryTabManager" />
        <projectService serviceImplementation="in.kkkev.jjidea.ui.services.ToolWindowEnabler" preload="true" />
        <projectService serviceImplementation="in.kkkev.jjidea.settings.JujutsuSettings" />

        <!-- Ignore .jj/ internal files to prevent VcsDirtyScopeVfsListener feedback loops -->
        <ignoredFileProvider implementation="in.kkkev.jjidea.vcs.changes.JujutsuIgnoredFileProvider" />

        <!-- Notifications -->
        <notificationGroup id="Jujutsu" displayType="BALLOON" />

        <!-- Settings -->
        <projectConfigurable
            id="vcs.Jujutsu"
            displayName="Jujutsu"
            instance="in.kkkev.jjidea.settings.JujutsuConfigurable"
            parentId="project.propVCSSupport.Mappings" />

        <!-- Jujutsu working copy tool window on the left side -->
        <toolWindow
            id="Working copy"
            anchor="left"
            icon="AllIcons.Vcs.Branch"
            factoryClass="in.kkkev.jjidea.ui.workingcopy.WorkingCopyToolWindowFactory"
        />
    </extensions>

    <actions>
        <action id="Jujutsu.Init" class="in.kkkev.jjidea.vcs.actions.InitAction">
            <add-to-group group-id="Vcs.Import"/>
            <add-to-group group-id="Vcs.Operations.Popup.NonVcsAware" relative-to-action="Start.Use.Vcs" anchor="before"/>
            <add-to-group group-id="Vcs.ToolWindow.CreateRepository"/>
            <override-text place="Vcs.Toolbar.Widget"/>
        </action>

        <action id="Jujutsu.GitFetch" class="in.kkkev.jjidea.vcs.actions.GitFetchAction"/>
        <action id="Jujutsu.GitPush" class="in.kkkev.jjidea.vcs.actions.GitPushAction"/>

        <!-- Open custom Jujutsu log tab -->
        <action id="Jujutsu.OpenLogTab"
                class="in.kkkev.jjidea.vcs.actions.OpenJujutsuLogTabAction">
            <!-- Text and description are set in the action class constructor -->
            <!-- Not added to VcsGroup to avoid StandardVcsGroup requirement -->
        </action>

        <!-- Show Diff action - defined before EditorGroup so it can be referenced -->
        <action id="Jujutsu.ShowChangesDiff" class="in.kkkev.jjidea.vcs.actions.ShowChangesDiffAction">
            <keyboard-shortcut first-keystroke="control D" keymap="$default"/>
            <keyboard-shortcut first-keystroke="meta D" keymap="Mac OS X"/>
            <keyboard-shortcut first-keystroke="meta D" keymap="Mac OS X 10.5+"/>
        </action>

        <!-- Jujutsu action group in editor context menu -->
        <group id="Jujutsu.EditorGroup" text="Jujutsu" class="in.kkkev.jjidea.vcs.actions.JujutsuEditorActionGroup" popup="true">
            <reference ref="Annotate"/>
            <reference ref="Jujutsu.ShowChangesDiff"/>
            <action id="Jujutsu.CompareWithBranch" class="in.kkkev.jjidea.vcs.actions.JujutsuCompareWithBranchAction"/>
            <action id="Jujutsu.ShowFileHistory" class="in.kkkev.jjidea.vcs.actions.ShowJujutsuFileHistoryAction"/>
            <action id="Jujutsu.ShowHistoryForSelection" class="in.kkkev.jjidea.vcs.actions.JujutsuShowHistoryForSelectionAction"/>
            <action id="Jujutsu.RestoreFile" class="in.kkkev.jjidea.vcs.actions.RestoreSelectionAction"/>
            <!--<add-to-group group-id="EditorPopupMenu" anchor="after" relative-to-action="EditorPopupMenu.GoToMenu"/>-->
            <add-to-group group-id="VcsGroup" anchor="last"/>
        </group>

        <!-- Restore to revision action for VCS Log changes browser and file history -->
        <action id="Jujutsu.RestoreToRevision" class="in.kkkev.jjidea.vcs.actions.RestoreToRevisionAction">
            <add-to-group group-id="Vcs.Log.ChangesBrowser.Popup" anchor="last"/>
            <add-to-group group-id="Vcs.FileHistory.ContextMenu" anchor="last"/>
        </action>

        <!-- File change context menu actions for custom panels -->
        <action id="Jujutsu.OpenChangeFile" class="in.kkkev.jjidea.vcs.actions.OpenChangeFileAction"/>
        <action id="Jujutsu.RestoreToChange" class="in.kkkev.jjidea.vcs.actions.RestoreToChangeAction"/>
        <action id="Jujutsu.CompareWithLocal" class="in.kkkev.jjidea.vcs.actions.CompareWithLocalAction"/>
        <action id="Jujutsu.CompareBeforeWithLocal" class="in.kkkev.jjidea.vcs.actions.CompareBeforeWithLocalAction"/>
        <action id="Jujutsu.OpenRepositoryVersion" class="in.kkkev.jjidea.vcs.actions.OpenRepositoryVersionAction"/>
    </actions>

</idea-plugin>
